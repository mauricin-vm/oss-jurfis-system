// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["public", "jurfis"]
}

// ============================================================================
// SCHEMA: public
// Authentication and User Management
// ============================================================================

model User {
  id                  String               @id @default(cuid())
  name                String?
  email               String               @unique
  password            String
  emailVerified       DateTime?
  image               String?
  organizationMembers OrganizationMember[]
  overtimeRecords     OvertimeRecord[]
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt

  @@map("User")
  @@schema("public")
}

model Organization {
  id              String               @id @default(cuid())
  name            String
  slug            String               @unique
  members         OrganizationMember[]
  overtimeRecords OvertimeRecord[]
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt

  @@map("Organization")
  @@schema("public")
}

model OrganizationMember {
  id             String           @id @default(cuid())
  userId         String
  organizationId String
  role           OrganizationRole
  user           User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  organization   Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt

  @@unique([userId, organizationId])
  @@map("OrganizationMember")
  @@schema("public")
}

enum OrganizationRole {
  ADMIN
  EMPLOYEE
  EXTERNAL

  @@schema("public")
}

// ============================================================================
// SCHEMA: jurfis
// Scheduling System (Meeting Management)
// ============================================================================

model Meeting {
  id              String        @id @default(cuid())
  title           String
  date            DateTime
  startTime       String
  endTime         String
  requestedBy     String?
  email           String?
  phone           String?
  contacts        String?
  notes           String?       @db.Text
  status          MeetingStatus @default(APPROVED)
  rejectionReason String?       @db.Text
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@map("Scheduling_Meeting")
  @@schema("jurfis")
}

enum MeetingStatus {
  PENDING
  APPROVED
  REJECTED

  @@schema("jurfis")
}

// ============================================================================
// SCHEMA: jurfis
// Overtime System (Employee Overtime Tracking)
// ============================================================================

model OvertimeRecord {
  id                 String       @id @default(cuid())
  userId             String
  organizationId     String
  user               User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  organization       Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  month              Int // 1-12
  year               Int // 2024, 2025...
  extraHours         Float // Horas extras do mês
  lateHours          Float // Horas de atraso
  balance            Float // extraHours - lateHours
  accumulatedBalance Float // Saldo acumulado até este mês
  documentPath       String? // Caminho do arquivo no servidor de rede
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt

  @@index([userId, organizationId, year, month])
  @@index([organizationId])
  @@map("Overtime_Record")
  @@schema("jurfis")
}
